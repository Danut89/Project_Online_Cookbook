{% extends 'base.html' %}
{% block content %}

<section class="container py-5">

  <!-- 🛠️ Dashboard Heading -->
  <div class="mb-5 text-center">
    <h1 class="fw-bold text-primary display-6">🛠️ Admin Dashboard</h1>
    <p class="text-muted">Overview of users, recipes, and comments.</p>
  </div>

  <!-- ✅ Quick Actions -->
  <div class="d-flex flex-wrap gap-3 justify-content-center mb-5">
    <a href="{{ url_for('main.add_recipe') }}" class="btn btn-success rounded-pill px-4">➕ Add New Recipe</a>
    <a href="{{ url_for('main.manage_users') }}" class="btn btn-outline-primary rounded-pill px-4">👥 Manage Users</a>
    <a href="{{ url_for('main.manage_recipes') }}" class="btn btn-outline-warning rounded-pill px-4">📋 Manage Recipes</a>
    <a href="{{ url_for('main.browse_recipes') }}" class="btn btn-outline-info rounded-pill px-4">🏷 All Recipes</a>
  </div>

  <!-- 📊 Styled Summary Cards -->
  <div class="row g-4 mb-5 text-center">
    <div class="col-md-3">
      <div class="bg-white p-4 shadow-sm rounded-4 dashboard-card users">
        <h6 class="fw-bold mb-1">👥 Users</h6>
        <p class="fs-3 text-primary">{{ users|length }}</p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="bg-white p-4 shadow-sm rounded-4 dashboard-card recipes">
        <h6 class="fw-bold mb-1">📖 Recipes</h6>
        <p class="fs-3 text-success">{{ recipes|length }}</p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="bg-white p-4 shadow-sm rounded-4 dashboard-card comments">
        <h6 class="fw-bold mb-1">💬 Comments</h6>
        <p class="fs-3 text-warning">{{ comments|length }}</p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="bg-white p-4 shadow-sm rounded-4 dashboard-card likes">
        <h6 class="fw-bold mb-1">❤️ Total Likes</h6>
        <p class="fs-3 text-danger">{{ total_likes }}</p>
      </div>
    </div>
  </div>

  <!-- 👥 All Users Table -->
  <div class="mb-5">
    <h4 class="fw-bold mb-3">👥 All Users</h4>
    <div class="table-responsive">
      <table class="table table-hover align-middle shadow-sm">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>Admin</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr>
            <td>{{ user.id }}</td>
            <td>{{ user.username }}</td>
            <td>{{ user.email }}</td>
            <td>
              {% if user.is_admin %}
              <span class="badge bg-success">Yes</span>
              {% else %}
              <span class="badge bg-secondary">No</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- 📖 All Recipes Table -->
  <div class="mb-5">
    <h4 class="fw-bold mb-3">📖 All Recipes</h4>
    <div class="table-responsive">
      <table class="table table-hover align-middle shadow-sm">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Author</th>
            <th>Difficulty</th>
            <th>Prep Time</th>
          </tr>
        </thead>
        <tbody>
          {% for recipe in recipes %}
          <tr>
            <td>{{ recipe.id }}</td>
            <td>{{ recipe.title }}</td>
            <td>{{ recipe.user.username }}</td>
            <td><span class="badge bg-warning text-dark">{{ recipe.difficulty }}</span></td>
            <td>{{ recipe.prep_time }} min</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- 💬 All Comments Table -->
  <div>
    <h4 class="fw-bold mb-3">💬 All Comments</h4>
    <div class="table-responsive">
      <table class="table table-hover align-middle shadow-sm">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>User</th>
            <th>Recipe</th>
            <th>Comment</th>
          </tr>
        </thead>
        <tbody>
          {% for comment in comments %}
          <tr>
            <td>{{ comment.id }}</td>
            <td>{{ comment.user.username }}</td>
            <td>{{ comment.recipe.title }}</td>
            <td>{{ comment.content }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</section>

<!-- 📊 Analytics Section -->
<h4 class="mt-5 mb-3 fw-semibold">📊 Analytics</h4>
<div class="row text-center">
  <div class="col-md-4">
    <div class="border rounded-4 p-4 bg-light shadow-sm">
      <h6 class="text-muted">📅 Recipes This Week</h6>
      <h3 class="text-primary">{{ recipes_this_week }}</h3>
    </div>
  </div>
  <div class="col-md-4">
    <div class="border rounded-4 p-4 bg-light shadow-sm">
      <h6 class="text-muted">📆 Recipes This Month</h6>
      <h3 class="text-primary">{{ recipes_this_month }}</h3>
    </div>
  </div>
  <div class="col-md-4">
    <div class="border rounded-4 p-4 bg-light shadow-sm">
      <h6 class="text-muted">❤️ Most Liked Recipe</h6>
      {% if most_liked_recipe %}
        <p class="fw-bold mb-1">{{ most_liked_recipe.title }}</p>
        <small class="text-muted">By {{ most_liked_recipe.user.username }}</small>
      {% else %}
        <p class="text-muted">No likes yet</p>
      {% endif %}
    </div>
  </div>
</div>


{% endblock %}
